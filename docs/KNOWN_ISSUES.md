# 已知問題 - Known Issues

> 相關文檔: [PROGRESS.md](./PROGRESS.md) | [DEVELOPMENT_GUIDE.md](./DEVELOPMENT_GUIDE.md)

## 📊 問題總覽 (Issue Summary)

| 優先級 | 問題數量 | 狀態 |
|--------|----------|------|
| 🔴 高優先級 | 3 | 1 待修復, 2 已修復 |
| 🟡 中優先級 | 4 | 需要進一步測試 |
| 🟢 低優先級 | 3 | 持續改進中 |

## 🔴 高優先級問題 (High Priority Issues)

### 1. ~~iPhone 觸控系統問題~~ ✅ **已修復** (2025-01-10)
- **修復狀態**: ✅ 完全解決
- **修復方法**: 
  - 重新設計觸控事件處理機制
  - 使用 touchstart 取代 touchend 事件
  - 添加 touch-action CSS 屬性
  - 實現 iPhone 特定的事件處理邏輯
- **測試確認**: iPhone Safari/Chrome 現在能正常操作所有按鈕和遊戲控制

### 2. iPhone 音效系統問題 ❌ **未修復**
- **影響設備**: iPhone (iOS Safari/Chrome)
- **正常設備**: iPad, Android, PC
- **症狀**:
  - 所有音效無法播放
  - Web Audio API 初始化失敗
  - 用戶互動檢測無效
- **根本原因**:
  - iPhone 對 Web Audio API 的安全限制更嚴格
  - 需要更明確的用戶互動才能啟動音頻上下文
  - AudioContext 狀態管理需要特別處理

### 3. 手機版經驗條位置問題 ✅ **已修復**
- **影響設備**: 所有手機/平板設備
- **症狀**: 經驗條顯示在畫面中間而非底部
- **解決方案**: 
  - 使用 `visualViewport` API 獲取準確的可視區域
  - 實現 `resetTransform()` 座標系統重置
  - 添加設備特定的座標計算邏輯
- **修復日期**: 2024-07-09

## 🟡 中優先級問題 (Medium Priority Issues)

### 4. 連擊文字顯示方向問題 ✅ **已修復**
- **影響設備**: 所有設備
- **症狀**: 中文字「連擊」垂直顯示而非水平
- **解決方案**: 
  - 添加 `writing-mode: horizontal-tb`
  - 使用 `white-space: nowrap` 確保文字方向
  - 優化中文字體顯示
- **修復日期**: 2024-07-09

### 5. 手機控制系統穩定性 ⚠️ **部分修復**
- **影響設備**: 部分 Android 和 iPhone 設備
- **症狀**:
  - DPAD 控制器偶爾會卡住
  - 觸控響應延遲
  - 雙搖桿衝突
- **狀態**: 需要更多設備測試

### 6. 效能問題 ⚠️ **持續優化**
- **影響設備**: 低端手機和舊設備
- **症狀**:
  - 大量敵人時出現卡頓
  - 粒子效果影響幀率
  - 記憶體使用量偏高
- **改善措施**:
  - 實現物件池系統
  - 優化繪製調用
  - 調整效果品質設定

### 7. 遊戲平衡性問題 ⚠️ **持續調整**
- **影響範圍**: 所有平台
- **症狀**:
  - 某些法術過強或過弱
  - 敵人生成速度需要調整
  - 經驗值和升級速度不平衡
- **狀態**: 需要更多遊戲數據分析

## 🟢 低優先級問題 (Low Priority Issues)

### 8. UI 響應式設計 ⚠️ **持續改進**
- **影響設備**: 特殊螢幕比例設備
- **症狀**:
  - 某些螢幕尺寸下介面可能不完整
  - 極寬或極窄螢幕適配問題
- **改善**: 逐步優化媒體查詢

### 9. 瀏覽器兼容性 ⚠️ **已知限制**
- **影響範圍**: 舊版瀏覽器
- **症狀**:
  - 部分 Web Audio API 功能不支援
  - Canvas 效能差異
- **狀態**: 考慮添加降級方案

### 10. 視覺效果優化 ⚠️ **持續改進**
- **影響範圍**: 所有平台
- **症狀**:
  - 部分特效在手機上表現不佳
  - 需要更多視覺回饋
- **狀態**: 美術資源待完善

## 🔧 解決方案和技術分析

### iPhone 問題解決策略

```javascript
// 建議的 iPhone 特別處理
if (navigator.userAgent.includes('iPhone')) {
    // 使用 touchstart 取代 touchend
    button.addEventListener('touchstart', handleButtonClick);
    
    // 添加 CSS 觸控優化
    button.style.touchAction = 'manipulation';
    
    // 音效系統特別初始化
    await initializeAudioForIPhone();
}
```

### 效能優化建議

1. **物件池使用**: 重複利用敵人和法術物件
2. **Canvas 優化**: 減少 draw calls 和狀態變更
3. **記憶體管理**: 及時清理不用的引用
4. **條件渲染**: 根據設備能力調整效果品質

### 測試覆蓋範圍

| 設備類型 | 觸控操作 | 音效系統 | 遊戲操作 | 整體狀態 |
|---------|---------|---------|---------|---------|
| iPhone  | ✅      | ❌      | ✅      | 僅音效問題 |
| iPad    | ✅      | ✅      | ✅      | 正常     |
| Android | ✅      | ✅      | ⚠️      | 大部分正常 |
| PC      | ✅      | ✅      | ✅      | 優秀     |

## 🚀 修復優先級和計劃

### 緊急修復 (Emergency Fix)
1. ~~iPhone 觸控系統~~ ✅ 已完成 (2025-01-10)
2. **iPhone 音效系統**: 實現降級方案和特別初始化

### 短期改善 (Short-term Improvements)
1. **手機控制穩定性**: 全面測試和優化
2. **效能優化**: 實現更好的物件池和渲染優化
3. **UI 響應式**: 完善媒體查詢和適配邏輯

### 長期計劃 (Long-term Plans)
1. **全面重構手機系統**: 建立更強健的觸控和音效架構
2. **遊戲平衡調整**: 基於數據分析的平衡性改進
3. **視覺效果增強**: 添加更多特效和動畫

## 📋 測試需求 (Testing Requirements)

### 設備測試需求
- 更多 iPhone 型號測試 (iPhone 12, 13, 14, 15)
- 不同 iOS 版本相容性測試
- Safari vs Chrome 行為差異分析
- 低端 Android 設備測試

### 功能測試重點
- 觸控事件在不同設備上的行為
- 音效系統在各種情況下的表現
- 長時間遊戲的穩定性
- 記憶體洩漏檢測

### 自動化測試考慮
- 單元測試覆蓋核心邏輯
- 集成測試驗證系統協作
- 效能測試監控關鍵指標

## 🐛 問題報告流程

### 如何報告問題
1. 使用 GitHub Issues 建立問題報告
2. 包含詳細的復現步驟
3. 提供設備信息和瀏覽器版本
4. 附上相關的錯誤日誌和截圖

### 問題分類標準
- **Critical**: 影響核心功能，阻擋用戶使用
- **High**: 影響重要功能，但有替代方案
- **Medium**: 影響用戶體驗，需要改進
- **Low**: 小問題，可以稍後處理

---

**最後更新**: 2025-01-10  
**維護者**: Claude Code Team  
**下次檢查**: 2025-01-17  
**專案狀態**: 95% 完成  
**相關文檔**: [PROGRESS.md](./PROGRESS.md) | [DEVELOPMENT_GUIDE.md](./DEVELOPMENT_GUIDE.md)  
**專案倉庫**: https://github.com/Chuanyin1202/kanisurvivor