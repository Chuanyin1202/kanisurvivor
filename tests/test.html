<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kani éŠæˆ²æ¸¬è©¦</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .success {
            background: #27ae60;
        }
        .error {
            background: #e74c3c;
        }
        .warning {
            background: #f39c12;
        }
        #gameCanvas {
            border: 2px solid #4a90e2;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ® Kani: Pixel Mage Survivor - éŠæˆ²æ¸¬è©¦</h1>
    <div id="testResults"></div>
    
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <div>
        <button onclick="runTests()">åŸ·è¡Œæ¸¬è©¦</button>
        <button onclick="testGame()">æ¸¬è©¦éŠæˆ²</button>
    </div>
    
    <!-- è¼‰å…¥æ‰€æœ‰å¿…è¦çš„è…³æœ¬ -->
    <script src="js/utils/vector2.js"></script>
    <script src="js/utils/objectPool.js"></script>
    <script src="js/utils/storage.js"></script>
    <script src="js/core/gameState.js"></script>
    <script src="js/core/assetLoader.js"></script>
    <script src="js/core/renderer.js"></script>
    <script src="js/config/gameBalance.js"></script>
    <script src="js/config/settings.js"></script>
    <script src="js/entities/player.js"></script>
    <script src="js/entities/enemy.js"></script>
    <script src="js/entities/projectile.js"></script>
    <script src="js/managers/waveManager.js"></script>
    
    <script>
        function addTestResult(message, type = 'success') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = message;
            document.getElementById('testResults').appendChild(resultDiv);
        }
        
        function runTests() {
            // æ¸…é™¤ä¹‹å‰çš„æ¸¬è©¦çµæœ
            document.getElementById('testResults').innerHTML = '';
            
            try {
                // æ¸¬è©¦ Vector2 é¡åˆ¥
                const v1 = new Vector2(3, 4);
                const v2 = new Vector2(1, 1);
                const v3 = Vector2.add(v1, v2);
                
                if (v3.x === 4 && v3.y === 5) {
                    addTestResult('âœ… Vector2 é¡åˆ¥æ¸¬è©¦é€šé');
                } else {
                    addTestResult('âŒ Vector2 é¡åˆ¥æ¸¬è©¦å¤±æ•—', 'error');
                }
                
                // æ¸¬è©¦ ObjectPool
                const pool = new ObjectPool(() => ({ value: 0 }), obj => obj.value = 0, 5);
                const obj = pool.acquire();
                if (obj && pool.getActiveCount() === 1) {
                    addTestResult('âœ… ObjectPool æ¸¬è©¦é€šé');
                } else {
                    addTestResult('âŒ ObjectPool æ¸¬è©¦å¤±æ•—', 'error');
                }
                
                // æ¸¬è©¦ GameBalance
                const playerHealth = gameBalance.getValue('player', 'baseHealth');
                if (playerHealth === 100) {
                    addTestResult('âœ… GameBalance é…ç½®æ¸¬è©¦é€šé');
                } else {
                    addTestResult('âŒ GameBalance é…ç½®æ¸¬è©¦å¤±æ•—', 'error');
                }
                
                // æ¸¬è©¦ Renderer
                const canvas = document.getElementById('gameCanvas');
                const renderer = new Renderer(canvas);
                if (renderer && renderer.ctx) {
                    addTestResult('âœ… Renderer åˆå§‹åŒ–æ¸¬è©¦é€šé');
                } else {
                    addTestResult('âŒ Renderer åˆå§‹åŒ–æ¸¬è©¦å¤±æ•—', 'error');
                }
                
                // æ¸¬è©¦ Player å‰µå»º
                const player = new Player(400, 300);
                if (player && player.position.x === 400 && player.position.y === 300) {
                    addTestResult('âœ… Player å‰µå»ºæ¸¬è©¦é€šé');
                } else {
                    addTestResult('âŒ Player å‰µå»ºæ¸¬è©¦å¤±æ•—', 'error');
                }
                
                // æ¸¬è©¦ Enemy å‰µå»º
                const enemy = new Enemy(100, 100, 'slime');
                if (enemy && enemy.type === 'slime') {
                    addTestResult('âœ… Enemy å‰µå»ºæ¸¬è©¦é€šé');
                } else {
                    addTestResult('âŒ Enemy å‰µå»ºæ¸¬è©¦å¤±æ•—', 'error');
                }
                
                // æ¸¬è©¦ç®¡ç†å™¨
                if (typeof waveManager !== 'undefined' && typeof enemyManager !== 'undefined') {
                    addTestResult('âœ… éŠæˆ²ç®¡ç†å™¨è¼‰å…¥æ¸¬è©¦é€šé');
                } else {
                    addTestResult('âŒ éŠæˆ²ç®¡ç†å™¨è¼‰å…¥æ¸¬è©¦å¤±æ•—', 'error');
                }
                
                addTestResult('ğŸ‰ æ‰€æœ‰æ¸¬è©¦å®Œæˆï¼', 'success');
                
            } catch (error) {
                addTestResult(`âŒ æ¸¬è©¦éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
                console.error('æ¸¬è©¦éŒ¯èª¤:', error);
            }
        }
        
        function testGame() {
            try {
                const canvas = document.getElementById('gameCanvas');
                const renderer = new Renderer(canvas);
                
                // å‰µå»ºæ¸¬è©¦ç©å®¶
                const player = new Player(400, 300);
                
                // å‰µå»ºæ¸¬è©¦æ•µäºº
                enemyManager.spawnEnemy('slime', 200, 200);
                enemyManager.spawnEnemy('goblin', 600, 400);
                
                // åŸºæœ¬æ¸²æŸ“æ¸¬è©¦
                let frame = 0;
                function testRender() {
                    renderer.clear('#1a1a2e');
                    renderer.beginFrame();
                    
                    // æ¸²æŸ“æ•µäºº
                    enemyManager.render(renderer);
                    
                    // æ¸²æŸ“ç©å®¶
                    player.render(renderer);
                    
                    // é¡¯ç¤ºå¹€æ•¸
                    renderer.drawText(`æ¸¬è©¦å¹€: ${frame}`, 10, 10, '#ffffff');
                    renderer.drawText('ç§»å‹•: WASD éµ', 10, 30, '#ffffff');
                    renderer.drawText('æ³•è¡“: æ»‘é¼ å·¦éµ', 10, 50, '#ffffff');
                    renderer.drawText('è¡åˆº: ç©ºç™½éµ', 10, 70, '#ffffff');
                    
                    renderer.endFrame();
                    
                    frame++;
                    if (frame < 60) { // åªæ¸²æŸ“ 60 å¹€æ¸¬è©¦
                        requestAnimationFrame(testRender);
                    }
                }
                
                testRender();
                addTestResult('ğŸ® éŠæˆ²æ¸²æŸ“æ¸¬è©¦å•Ÿå‹•', 'success');
                
            } catch (error) {
                addTestResult(`âŒ éŠæˆ²æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                console.error('éŠæˆ²æ¸¬è©¦éŒ¯èª¤:', error);
            }
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•åŸ·è¡Œæ¸¬è©¦
        window.addEventListener('load', () => {
            setTimeout(runTests, 1000);
        });
    </script>
</body>
</html>